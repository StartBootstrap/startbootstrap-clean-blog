/*!
 * Start Bootstrap - Clean Blog v5.0.1 (https://startbootstrap.com/template-overviews/clean-blog)
 * Copyright 2013-2019 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap-clean-blog/blob/master/LICENSE)
 */

var numPage,keyword,mode,error,fs=require("fs"),path=require("path"),blogPerPage=3,currPage=1,month=new Map([["01","Januray"],["02","Feburary"],["03","March"],["04","April"],["05","May"],["06","June"],["07","July"],["08","August"],["09","September"],["10","October"],["11","November"],["12","December"]]),MODE={INDEX:0,TAG:1,SEARCH:2},blogs=[],defaultImage="./posts/default.jpg";function init_page(){var e=window.location.search;mode=e.includes("tag")?(console.log("tag mode"),keyword=e.substring(e.indexOf("=")+1,e.length),MODE.TAG):e.includes("keyword")?(console.log("search mode"),keyword=e.substring(e.indexOf("=")+1,e.length),MODE.SEARCH):(console.log(mode),MODE.INDEX),console.log("tag is "+keyword),error=!0;var t=search_blog();t=t.reverse(),0<(numPage=Math.ceil(t.length/blogPerPage))&&mode==MODE.INDEX&&setup_pagination(),setup_page()}function search_blog(){var e=fs.readdirSync("./posts/");for(var t in e)".html"===path.extname(e[t])&&blogs.push(e[t]);return blogs}function setup_page(){var e,t=(currPage-1)*blogPerPage;if(t<0||t>=blogs.length)console.log("error!");else for(mode==MODE.INDEX?(e=Math.min(t+blogPerPage,blogs.length),console.log("index")):e=blogs.length,i=t;i<e;i++)parse_html("./posts/"+blogs[i],i)}function setup_pagination(){for($("#paginator").html('<div id="paginator-placeholder"></div>'),1==currPage?$("#paginator-placeholder").before('<li class="page-item disabled" id="newer_button"><a class="page-link" href="javascript:on_newer_blog()">&larr; Newer</a></li>'):$("#paginator-placeholder").before('<li class="page-item" id="newer_button"><a class="page-link" href="javascript:on_newer_blog()">&larr; Newer</a></li>'),i=1;i<=numPage;i++)currPage==i?$("#paginator-placeholder").before('<li class="page-item active"><a class="page-link" href="javascript:on_page_number('+i+')">'+i+"</a></li>"):$("#paginator-placeholder").before('<li class="page-item"><a class="page-link" href="javascript:on_page_number('+i+')">'+i+"</a></li>");currPage==numPage?$("#paginator-placeholder").before('<li class="page-item disabled" id="older_button"><a class="page-link" href="javascript:on_older_blog()">Older &rarr;</a></li>'):$("#paginator-placeholder").before('<li class="page-item" id="older_button"><a class="page-link" href="javascript:on_older_blog()">Older &rarr;</a></li>')}function parse_html(e,t){var o=new XMLHttpRequest;o.addEventListener("load",function(){load_card(o.response,e,t)},!1),o.open("GET",e),o.send()}function load_card(e,t,o){if(parser=new DOMParser,htmlDoc=parser.parseFromString(e,"text/html"),mode==MODE.INDEX||mode==MODE.TAG&&htmlDoc.getElementById("tag").childNodes[0].innerText==keyword||mode==MODE.SEARCH&&htmlDoc.body.textContent.match(RegExp(keyword,"gi"))){error&&(error=!1,document.getElementById("card-list-placeholder").innerText="");var r=t.replace("html","jpg"),n=t.slice(8,18);n=n.split("_"),document.getElementById("card-list-placeholder").innerHTML+='<div class="card mb-4" id="post_'+o.toString()+'"></div>',document.getElementById("post_"+o.toString()).innerHTML+='<img class="card-img-top" src="'+r+'" alt="Card image cap"/>',document.getElementById("post_"+o.toString()).innerHTML+='<div class="card-body"><h2 class="card-title" align-items-center>'+htmlDoc.getElementById("title").childNodes[0].nodeValue+"</h2>",document.getElementById("post_"+o.toString()).innerHTML+='<a href="'+t+'" class="btn btn-primary">Read More &rarr;</a></div>';var a="'"+htmlDoc.getElementById("tag").childNodes[0].innerText+"'";document.getElementById("post_"+o.toString()).innerHTML+='<div class="card-footer text-muted">Posted on '+month.get(n[1])+" "+n[2]+", "+n[0]+'  <kbd id="tag"><a href="javascript:on_tag('+a+')">'+htmlDoc.getElementById("tag").childNodes[0].innerText+"</a></kbd>",$(".card-img-top").on("error",function(){$(this).attr("src","./posts/default.jpg")})}else error&&(document.getElementById("card-list-placeholder").innerText="There is no blog :(")}function dummy(){console.log("dummy")}$(function(){init_page()}),window.on_older_blog=function(){numPage<++currPage&&(currPage=numPage,document.getElementById("older_button").disabled=!0),document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_newer_blog=function(){1<--currPage&&(currPage=numPage),document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_page_number=function(e){currPage=e,document.getElementById("blog-title").scrollIntoView(!0),document.getElementById("card-list-placeholder").innerHTML="",setup_page(),setup_pagination()},window.on_tag=function(e){window.location.href="./index.html?tag="+e},window.on_search=function(e){window.location.href="./index.html?keyword="+e},window.on_keyup=function(e){13==e.keyCode&&document.getElementsByName("search-btn")[0].click()};